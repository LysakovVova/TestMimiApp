<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    /* Базовые настройки для всего тела страницы */
    body {
        font-family: sans-serif;
        /* Используем переменные Телеграма. 
           Если переменной нет (открыли в браузере), будет белый фон (#fff) */
        background-color: var(--tg-theme-bg-color, #fff);
        color: var(--tg-theme-text-color, #000); 
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center; /* Центрируем всё */
    }

    h2 {
        margin-top: 0;
    }

    /* Красивые поля ввода */
    input {
        box-sizing: border-box; /* Чтобы padding не ломал ширину */
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        font-size: 16px;
        border-radius: 10px; /* Закругленные углы */
        border: 1px solid var(--tg-theme-hint-color, #ccc);
        
        /* Фон поля ввода чуть отличается от основного фона */
        background-color: var(--tg-theme-secondary-bg-color, #f0f0f0); 
        color: var(--tg-theme-text-color, #000);
        outline: none; /* Убираем синюю обводку при клике */
    }

    /* Поля ввода при нажатии */
    input:focus {
        border-color: var(--tg-theme-button-color, #3390ec);
    }

    /* Красивая кнопка */
    button {
        width: 100%;
        padding: 14px;
        margin-top: 15px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        
        /* Цвета кнопки как в Телеграме */
        background-color: var(--tg-theme-button-color, #3390ec);
        color: var(--tg-theme-button-text-color, #ffffff);
    }

    /* Эффект нажатия на кнопку */
    button:active {
        opacity: 0.8; /* Чуть прозрачнее при клике */
    }

    /* Блок результата */
    #res {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
        width: 100%;
        text-align: center;
    }
</style>
</head>

<body>

<h2>границы</h2>

<input id="min_txt" type="number" placeholder="нижняя">
<input id="max_txt" type="number" placeholder="верхняя">
<hr>

<button id="send">получить число</button>
<div id="res"></div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

async function loadProfile() {
  const r = await fetch("/api/auth", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ initData: tg.initData })
  });

  if (!r.ok) {
    document.getElementById("res").innerText = "Ошибка авторизации";
    return;
  }

  const data = await r.json();
  // data может содержать user_id и любые данные профиля
  document.getElementById("res").innerText = `последнее число = ${data.last_number}`;
}

loadProfile();

const API_NUMBER = "/api/number";
const API_ECHO   = "/api/echo";

document.getElementById("send").onclick = async () => { // при клике на кнопку отправляем запрос на сервер для получения случайного числа в заданных границах
  const out = document.getElementById("res");


  const min = document.getElementById("min_txt").value;
  const max = document.getElementById("max_txt").value;

  const minNum = Number(min);
  const maxNum = Number(max);

  if (isNaN(minNum) || isNaN(maxNum)) {
    out.innerText = "Введите числа!";
    return;
  }

  try {
    out.innerText = "Загрузка...";

    const r = await fetch(API_NUMBER, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        user_id: tg.initDataUnsafe.user.id,
        min: Number(min),
        max: Number(max)
      })
    });

    if (!r.ok) {
      throw new Error("HTTP " + r.status);
    }

    const data = await r.json();

    if (data.error) {
      out.innerText = "Ошибка: " + data.error;
      return;
    }
    if (data.number) {
      out.innerText = "Ваше число: " + data.number;
    } else {
      out.innerText = "Ответ сервера не содержит число";
    }

  } catch (e) {
    console.error(e);
    out.innerText = "Ошибка";
  }
};

</script>

</body>
</html>
